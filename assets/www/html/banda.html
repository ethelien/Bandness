<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!--
To change this template, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<link rel="stylesheet" href="../css/banda.css">
		<script type='text/javascript' src='../js/cordova-1.5.0.js'></script>
		<script src="../js/jquery-1.7.2.min.js"></script>
		<script src="../js/jquery.jsonp-2.2.1.js"></script>
	
		<script>
		var $resultados;
		var $banda;
		var $id;
		var var_nombre;
		var var_ciudad;
		var var_sello;
		var var_estilo="";
		var var_componentes="";
		var cabecera="";
		var dia;
		var mes;
		var id_evento;
		
		
	$(document).ready(function() {
        $("body").css("display", "none");
  	    $("body").fadeIn('slow');
    
        document.addEventListener("deviceready", function() {console.log("PhoneGap initialized.")}, false);    
    });

//jsFiddle does not fire the window onload properly, substituted with fake load

		
	    function onBodyLoad() {
	    	
			var paresVarValor = leerGET();
			id = paresVarValor['Banda'];
			id = 3;
			//mostrardatos();
			obtenerInfo();
			//obtenerEventos();
			//mostrardatos();
	    }
		
		function leerGET(){
 		    var cadGET = location.search.substr(1,location.search.length);
  			var arrGET = cadGET.split("&");
  			var asocGET = new Array();
  			var variable = "";
  			var valor = "";
  			for(i=0;i<arrGET.length;i++){
  				 var aux = arrGET[i].split("=");
   				 variable = aux[0];
   				 valor = aux[1];
   		 		asocGET[variable] = valor;
  			}
 		 return asocGET;
		} 
		
		
		function obtenerInfo() {
			
		    //resultados = $('#info');
		    
		    $.ajax({
		    	url: 'http://192.168.1.102/banda_informacion.php?banda='+id,
			        dataType: 'jsonp',
			        jsonp: 'jsoncallback',
			        type:'get',
			        timeout: 5000,
			        success: function(data/*, status*/){
			            $.each(data, function(i,item){
			            	if(i==0){
			            		var_nombre = item.name;
			                	var_ciudad = item.location;
			                	var_sello = item.label; 
			                	cabecera="http://test.bandness.com/uploads/images/band/header/"+item.header;   	
			            	}
			            	
			            	if(i==1){
			            		var_estilo+=item.Estilo; 		            
			            	}

							if(i==2){
				            	var_componentes+=item.Componentes;
				            }
			            });
			            obtenerEventos();
			        },
			        error: function(){
			            alert('no va');
			        }
			    });
			}
			
			function obtenerEventos() {
			
		    //resultados = $('#info');
		    
		    $.ajax({
		    	url: 'http://192.168.1.102/banda_evento.php?banda='+id,
			        dataType: 'jsonp',
			        jsonp: 'jsoncallback',
			        type:'get',
			        timeout: 5000,
			        success: function(data/*, status*/){
			            $.each(data, function(i,item){
		            		dia = item.Day;
		                	mes = item.Month;
		                	id_evento = item.id;
		                	
		                	añadireventos(dia,mes,id_evento)  						
			            });
			            mostrardatos();
			        },
			        error: function(){
			            alert('no va');
			        }
			    });
			}
			
			function añadireventos(dia, mes,id_evento){
				var TROW = document.getElementById("prox_eventos");
		        var newCell = TROW.insertCell(TROW.cells.length);
	  		    newCell.innerHTML = "<button id="+id_evento+" class='fecha_evento'>"
	  		    newCell.onclick=function(){Cargar_Evento(id_evento);}
	  		    	  		    
	  			var id_mes = mes+"_"+id_evento;
	  			var id_dia = dia+"_"+id_evento;

	  			var texto = document.getElementById(id_evento);
	  			var h4 = document.createElement("h4");
				h4.innerHTML = "<span id="+id_mes+" type='text' name='mes'></span><BR><span id="+id_dia+" type='text' name='dia' style='font-size: x-large'></span>"	
				texto.appendChild(h4);	
					    
			   	$('#'+id_mes).html(mes);
       			$('#'+id_dia).html(dia);
								
			}
		
		   	function continuar(){
		        //window.open("file:///android_asset/www/html/publico_banda.html?Banda="+valor);
				window.location = "bandas.html";		
			}
			
			function zonaprivada(){
				window.location = "login.html";		
			}
			
			function Cargar_Evento(x){
       			$("body").fadeOut('slow');     	
				window.location = "evento.html?Evento="+x;		
			}
			
			function mostrardatos() {
			    //$('#info').html($resultados);
			    $('#BANDA_imagen').prop('src',cabecera);		    
			    $('#BANDA_nombre').html(var_nombre);
			    $('#BANDA_ciudad').html(var_ciudad);
			    $('#BANDA_estilo').html(var_estilo);
			    $('#BANDA_sello').html(var_sello);
			    $('#BANDA_componentes').html(var_componentes);
			   // $("#cover").fadeOut('fast');
			    $("#base").fadeIn('1000');
			    //$.mobile.pageLoading(true);
			}

		</script>
		
		
	</head>

	<body onload="onBodyLoad()">
			 
			<!--  <div id="cover"> LOADING... </div> -->
			 
			 <div id="base">
			 
			  		<TABLE align="center" id="Busqueda">
						<TR>
  							<TD align="center" style="width:20%;">
  								<img id="BANDA_imagen" height='64' width='64'> </TD> 
  							<TD align="center" style="width:80%;">
  								<H1 style="display: inline;"><span id="BANDA_nombre" type="textarea" name="ciudad" style="color: white;"></span></H1></TD>
						</TR> 
					</TABLE>
				<div id="resul">
	        		 			
	 				<TABLE id="datos">
		 				<TR>
		 					<TD align="left" style="vertical-align:text-top"><h2 align="left">Ciudad: </h2> </TD>
		 					<TD align="left"><h2><span id="BANDA_ciudad" type="text" name="ciudad" style="color: black; display:inline"></span></h2></TD>
		 				</TR>
		 				<TR>
		 					<TD align="left" style="vertical-align:text-top"><h2 align="left">Componentes:</h2></TD>
		 					<TD align="left"><h2><span id="BANDA_componentes" type="text" name="estilo" style="color: black; display:inline"></span></h2></TD>
		 				</TR>
		 				<TR>
		 					<TD align="left" style="vertical-align:text-top"><h2 align="left">Estilo: </h2></TD> 
		 					<TD align="left"><h2><span id="BANDA_estilo" type="text" name="estilo" style="color: black; display:inline"></span></h2></TD>
		 				</TR>
						<TR>
		 					<TD align="left" style="vertical-align:text-top"><h2 align="left">Sello:</h2> </TD> 
		 					<TD align="left"><h2><span id="BANDA_sello" type="text" name="sello" style="color: black; display:inline"></span></h2></TD>				
		 				</TR>
		 			</TABLE>	
		 			<HR>
		 			
		 			<div id="eventos">
		 				<h1 align="center">Próximos eventos</h1>
		 				<TABLE align="center">		 				
		 					<TR align="center" id="prox_eventos">	 				
		 					</TR> 
		 				</TABLE>
		 			</div>	
		 				
	 			</div> 	
					
		 	
		 	<div id="zona">
		        <INPUT TYPE="button" id="Entrada_Bandness" style="width:50%; height:100%;" onclick="zonaprivada()">
		        <INPUT TYPE="button" value="Bandas actualizadas" style="width:50%; height:100%;" onclick="continuar()">
		    </div>
		    
		</div> 
	
    
</body>
</html>